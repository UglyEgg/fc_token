version: 1

AppDir:
  path: ./AppDir

  app_info:
    id: com.filecxx.fc-token
    name: File Centipede Activation Helper
    icon: fc_token
    version: 0.1.3
    # We run the console script installed into the venv.
    exec: usr/venv/bin/fc-token
    exec_args: $@

  runtime:
    env:
      # Make sure the venv binaries are found first.
      PATH: "$APPDIR/usr/venv/bin:$PATH"
      # Make Qt behave nicely in some desktop environments.
      QT_QPA_PLATFORMTHEME: "qt6ct"

  # Base system dependencies to pull in via apt.
  # Tune distro / versions as needed for your build host.
  apt:
    arch: amd64
    sources:
      - sourceline: "deb http://archive.ubuntu.com/ubuntu/ jammy main universe"
      - sourceline: "deb http://archive.ubuntu.com/ubuntu/ jammy-updates main universe"
    include:
      - python3
      - python3-venv
      - python3-pip
      - python3-distutils
      - python3-pyqt6
      - libgl1
      - libx11-6
      - libxext6
      - libxrender1
      - libxcb1
      - libxkbcommon0
      - libdbus-1-3
      - libglib2.0-0
      - ca-certificates
    exclude:
      - "*-dev"
      - "*-dbg"

  files:
    include:
      # Python + Qt libraries brought in by apt above.
      - /usr/bin/python3
      - /usr/lib/x86_64-linux-gnu
      - /usr/lib/python3
      - /usr/share/icons
      - /usr/share/qt6
    exclude:
      - /usr/share/doc
      - /usr/share/man
      - /usr/share/locale/*
      - /usr/share/icons/Adwaita

  # Build script: create a venv inside the AppDir and install this project.
  script:
    - |
      set -e
      echo "[fc-token] Creating virtualenv under AppDir/usr/venv"
      python3 -m venv "$APPDIR/usr/venv"
      "$APPDIR/usr/venv/bin/pip" install --upgrade pip wheel
      echo "[fc-token] Installing project into venv"
      "$APPDIR/usr/venv/bin/pip" install .

AppImage:
  arch: x86_64

  # Fill this in if you later want zsync-based updates.
  update-information: ""
  sign-key: null

  test:
    - path: AppDir
      command: usr/venv/bin/fc-token --version
      env:
        QT_QPA_PLATFORM: "offscreen"
    - path: AppDir
      command: usr/venv/bin/fc-token --self-test
      env:
        QT_QPA_PLATFORM: "offscreen"
